<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–¥–∞ ‚Äî –£–º–Ω–∞—è –î–æ—Å—Ç–∞–≤–∫–∞ (—É–ª—É—á—à–µ–Ω–æ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        :root{
            --bg-primary:#ffffff; --bg-secondary:#f3f4f6; --text-primary:#111827; --text-secondary:#6b7280; --accent:#facc15;
        }
        .yandex-input{ padding:12px 16px; border-radius:12px; border:1px solid #e5e7eb; font-size:16px; background:#f9fafb }
        .yandex-input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(250,204,21,0.12) }
        .modal{ transition:opacity .25s ease, transform .25s ease }
        .pw-strength { height:6px; border-radius:6px; background:#e6e6e6; overflow:hidden }
        .pw-strength > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#f59e0b) }
    </style>
</head>
<body class="bg-primary">
  <div class="min-h-screen">
    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur border-b border-gray-100">
      <div class="container mx-auto max-w-7xl px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center space-x-3">
            <!-- –ù–æ–≤—ã–π –ª–æ–≥–æ—Ç–∏–ø: –±–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π, SVG —Å —Ç–µ–∫—Å—Ç–æ–º -->
            <a id="brand" href="#" class="flex items-center gap-3">
              <svg width="44" height="44" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                <rect width="48" height="48" rx="12" fill="#FACC15"/>
                <path d="M16 14H32V18H20V22H30V26H20V30H16V14Z" fill="#111827"/>
              </svg>
              <span class="font-semibold text-lg text-primary">–ï–¥–∞</span>
            </a>
          </div>

          <div class="hidden lg:flex items-center space-x-4 w-full max-w-3xl ml-4">
            <button class="flex items-center space-x-2 py-2 px-4 rounded-full bg-gray-100 hover:bg-gray-200 text-sm font-medium" id="address-btn">
              <i data-lucide="map-pin" class="w-4 h-4"></i>
              <span id="address-display">–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å</span>
              <i data-lucide="chevron-down" class="w-3 h-3"></i>
            </button>
            <div class="relative flex-grow">
              <input id="manual-search" type="text" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ –±–ª—é–¥..." class="w-full pl-10 pr-4 py-2 rounded-full bg-secondary border border-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500 text-primary placeholder-color">
              <div class="absolute left-3 top-1/2 -translate-y-1/2"><i data-lucide="search" class="w-5 h-5 text-secondary"></i></div>
            </div>
          </div>

          <div class="flex items-center space-x-3">
            <button id="cart-btn" class="p-2 rounded-full hover:bg-secondary text-secondary relative hidden sm:block">
              <i data-lucide="shopping-cart" class="w-5 h-5"></i>
              <span id="cart-count" class="absolute -top-1 -right-1 bg-yellow-500 text-black text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">0</span>
            </button>

            <div id="user-area" class="flex items-center gap-3">
              <button id="login-button" class="text-sm font-medium py-1.5 px-4 rounded-full bg-gray-100 hover:bg-gray-200 transition">–í–æ–π—Ç–∏</button>
            </div>
          </div>

        </div>
      </div>
    </header>

    <main class="container mx-auto max-w-7xl px-4 py-8">
      <section class="mb-12">
        <div class="bg-gray-900 rounded-2xl p-6 md:p-10 text-white shadow-2xl">
          <div class="flex flex-col md:flex-row md:items-center">
            <div class="md:w-1/2 mb-6 md:mb-0">
              <h1 class="text-3xl md:text-4xl font-bold mb-3">–ù–µ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –ø–æ–µ—Å—Ç—å?</h1>
              <p class="text-lg text-gray-300 mb-6">–û–ø–∏—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –±—é–¥–∂–µ—Ç ‚Äî AI –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã.</p>
              <textarea id="ai-prompt" rows="3" class="w-full p-4 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-4 focus:ring-yellow-400 resize-none" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –•–æ—á—É —á—Ç–æ-—Ç–æ —Å—ã—Ç–Ω–æ–µ –¥–æ 600‚ÇΩ"></textarea>
              <div class="flex gap-3 mt-4">
                <button id="ai-button" class="inline-flex items-center gap-3 bg-yellow-500 text-black font-bold py-3 px-6 rounded-full shadow hover:bg-yellow-400 transition">
                  <span id="ai-button-text">–ù–∞–π—Ç–∏ –±–ª—é–¥–æ</span>
                  <svg id="ai-loader" class="hidden animate-spin w-5 h-5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#111827" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4" fill="none"></circle></svg>
                </button>
                <button id="ai-clear" class="px-4 py-3 rounded-full bg-gray-800 text-white">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>
            </div>
            <div id="ai-result-container" class="md:w-1/2 md:pl-10 min-h-[150px] flex items-center justify-center">
              <div id="ai-placeholder" class="text-center text-gray-500">
                <i data-lucide="sparkles" class="w-16 h-16 mx-auto opacity-50"></i>
                <p class="mt-2 text-lg">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏...</p>
              </div>
              <div id="ai-result" class="hidden bg-black/50 backdrop-blur-sm p-6 rounded-lg w-full">
                <h3 class="text-xl font-semibold mb-3 text-yellow-400">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h3>
                <div id="ai-output" class="text-base space-y-2 text-gray-100"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-6">
        <div id="categories-container" class="flex overflow-x-auto no-scrollbar space-x-3 pb-2"></div>
      </section>

      <section>
        <div id="restaurant-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
      </section>
    </main>

    <button id="support-btn" class="fixed bottom-6 right-6 z-50 p-4 rounded-full bg-yellow-500 text-black shadow-2xl hover:bg-yellow-400 transition transform hover:scale-105"><i data-lucide="help-circle" class="w-6 h-6"></i></button>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="modal fixed inset-0 z-[100] flex items-center justify-center opacity-0 pointer-events-none">
      <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl transform transition-all duration-300 scale-95">
        <div class="flex items-center mb-4">
          <button id="auth-back-button" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition hidden"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
          <h2 id="auth-title" class="text-xl font-bold text-center w-full">–í–æ–π–¥–∏—Ç–µ</h2>
          <button id="auth-close-button" class="p-2 -mr-2 rounded-full hover:bg-gray-100 transition"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>

        <div id="auth-screens">
          <div id="screen-main" class="space-y-4">
            <div class="flex p-1 bg-gray-100 rounded-xl mb-4" id="login-method-buttons">
              <button id="tab-email" class="w-1/2 py-2.5 rounded-xl text-sm font-medium bg-white shadow-sm">–ü–æ—á—Ç–∞</button>
              <button id="tab-phone" class="w-1/2 py-2.5 rounded-xl text-sm font-medium text-gray-500">–¢–µ–ª–µ—Ñ–æ–Ω</button>
            </div>

            <div id="login-email-screen">
              <div class="relative">
                <input id="login-email-input" type="text" class="yandex-input" placeholder="Email –∏–ª–∏ –ª–æ–≥–∏–Ω">
              </div>
              <div class="relative mt-3">
                <input id="login-password-input" type="password" class="yandex-input" placeholder="–ü–∞—Ä–æ–ª—å">
                <button id="toggle-login-pw" class="absolute right-3 top-3 text-gray-500" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å">üëÅÔ∏è</button>
              </div>
              <div class="flex gap-2 mt-4">
                <button id="login-submit-button" class="w-full py-3 rounded-xl bg-gray-900 text-white font-semibold">–í–æ–π—Ç–∏</button>
                <button id="go-to-register-button" class="w-full py-3 rounded-xl bg-gray-100">–°–æ–∑–¥–∞—Ç—å ID</button>
              </div>
            </div>

            <div id="login-phone-screen" class="hidden">
              <div class="phone-input-group flex space-x-2">
                <button class="flex-shrink-0 flex items-center justify-center bg-gray-200 rounded-xl px-3 text-sm font-medium"><span id="country-code-display">+7</span> <i data-lucide="chevron-down" class="w-4 h-4 ml-1"></i></button>
                <input id="login-phone-input" type="tel" class="yandex-input flex-grow" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
              </div>
              <button id="phone-submit-button" class="w-full mt-4 py-3 rounded-xl bg-gray-900 text-white font-semibold">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
            </div>

          </div>

          <div id="screen-code" class="hidden">
            <p class="text-center text-sm text-gray-600 mb-4">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –Ω–∞ –Ω–æ–º–µ—Ä <strong id="code-phone-display"></strong></p>
            <input id="sms-code-input" maxlength="4" class="yandex-input text-center text-2xl tracking-[0.5em] font-mono" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <p id="code-error-message" class="text-red-500 text-sm text-center mt-2 hidden">–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥</p>
            <button id="code-submit-button" class="w-full mt-4 py-3 rounded-xl bg-yellow-500 text-black font-semibold">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            <button id="resend-code-button" class="w-full mt-3 text-sm text-gray-500">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
          </div>

          <div id="screen-register" class="hidden space-y-4">
            <p class="text-center text-sm text-gray-600">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</p>
            <div class="flex p-1 bg-gray-100 rounded-xl mb-3" id="register-method-buttons">
              <button id="reg-tab-phone" class="w-1/2 py-2.5 rounded-xl text-sm font-medium bg-white shadow-sm">–¢–µ–ª–µ—Ñ–æ–Ω</button>
              <button id="reg-tab-email" class="w-1/2 py-2.5 rounded-xl text-sm font-medium text-gray-500">–ü–æ—á—Ç–∞</button>
            </div>

            <div id="register-phone-screen">
              <div class="phone-input-group flex space-x-2 mb-4">
                <button class="flex-shrink-0 flex items-center justify-center bg-gray-200 rounded-xl px-3 text-sm font-medium"><span>+7</span></button>
                <input id="register-phone-input" type="tel" class="yandex-input flex-grow" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
              </div>
              <button id="register-phone-submit-button" class="w-full py-3 rounded-xl bg-yellow-500 text-black font-semibold">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>

            <div id="register-email-screen" class="hidden space-y-3">
              <input id="register-email-input" type="email" class="yandex-input" placeholder="–ü–æ—á—Ç–∞">
              <div class="relative">
                <input id="register-password-input" type="password" class="yandex-input" placeholder="–ü–∞—Ä–æ–ª—å">
                <button id="toggle-reg-pw" class="absolute right-3 top-3 text-gray-500">üëÅÔ∏è</button>
              </div>
              <div class="pw-strength"><i id="pw-strength-bar" style="width:0%"></i></div>
              <input id="register-confirm-password-input" type="password" class="yandex-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
              <button id="register-email-submit-button" class="w-full mt-3 py-3 rounded-xl bg-yellow-500 text-black font-semibold">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>

            <p class="text-xs text-gray-400 pt-2 text-center">–ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –£—Å–ª–æ–≤–∏—è–º–∏</p>
          </div>

        </div>
      </div>
    </div>

    <script>
      // --- –ü—Ä–æ—Å—Ç–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è "–±–∞–∑–∞" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–µ—Å—Å–∏—è –≤ localStorage ---
      const STORAGE_KEYS = { USERS: 'ed_users_v1', SESSION: 'ed_session_v1', CART: 'ed_cart_v1' };

      function loadUsers(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS))||{} }catch(e){return{}} }
      function saveUsers(u){ localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(u)) }
      function saveSession(session){ localStorage.setItem(STORAGE_KEYS.SESSION, JSON.stringify(session)) }
      function loadSession(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION))||null}catch(e){return null} }
      function clearSession(){ localStorage.removeItem(STORAGE_KEYS.SESSION) }

      // --- Mock data (built at runtime to avoid template interpolation issues) ---
      const _NAMES = ["Burger Queen","Combo Kings","Pizza Bravo","–°—É—à–∏ Wok","GreenLeaf","–§–æ-–ë–æ '–•–∞–Ω–æ–π'","–ì–µ–Ω–∞—Ü–≤–∞–ª–µ","–°–ª–∞–¥–∫–∏–π –†–∞–π","–ö–æ—Ñ–µ–π–Ω—è 24/7","Vegan Power","–¢–µ—Å—Ç –†–µ—Å—Ç–æ—Ä–∞–Ω","–ü–∞—Å—Ç–∞ –õ–∞–í–∏—Ç–∞"];
      const _CUISINES = ["–ë—É—Ä–≥–µ—Ä—ã, –§–∞—Å—Ç—Ñ—É–¥","–ö–æ–º–±–æ","–ü–∏—Ü—Ü–∞, –ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è","–°—É—à–∏, –ê–∑–∏—è","–ó–¥–æ—Ä–æ–≤–∞—è –µ–¥–∞","–í—å–µ—Ç–Ω–∞–º—Å–∫–∞—è","–ì—Ä—É–∑–∏–Ω—Å–∫–∞—è","–î–µ—Å–µ—Ä—Ç—ã","–ö–æ—Ñ–µ","–í–µ–≥–∞–Ω","–†–∞–∑–Ω–æ–µ","–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"];
      const _CATEGORIES = ["–ë—É—Ä–≥–µ—Ä—ã","–ö–æ–º–±–æ","–ü–∏—Ü—Ü–∞","–°—É—à–∏","–ó–¥–æ—Ä–æ–≤—å–µ","–ê–∑–∏—è","–ì—Ä—É–∑–∏—è","–î–µ—Å–µ—Ä—Ç—ã","–ö–æ—Ñ–µ","–í–µ–≥–∞–Ω","–†–∞–∑–Ω–æ–µ","–ü–∞—Å—Ç–∞"];
      const _COLORS = ['f97316','facc15','eab308','111827','22c55e','06b6d4','a855f7','ec4899','374151','059669','9ca3af','fb923c'];

      const mockRestaurants = Array.from({length: 12}, (_, i) => ({
        name: _NAMES[i % _NAMES.length],
        cuisine: _CUISINES[i % _CUISINES.length],
        rating: (4.5 + (i % 5) * 0.1).toFixed(1),
        deliveryTime: (15 + 5 * i) + '-' + (25 + 5 * i) + ' –º–∏–Ω',
        image: 'https://placehold.co/600x400/' + _COLORS[i % _COLORS.length] + '/ffffff?text=' + encodeURIComponent(_NAMES[i % _NAMES.length]),
        category: _CATEGORIES[i % _CATEGORIES.length],
        freeDelivery: i % 3 === 0,
        priceRange: ['‚ÇΩ','‚ÇΩ‚ÇΩ','‚ÇΩ‚ÇΩ‚ÇΩ'][i % 3]
      }));

      const categories = [
        {label:'–í—Å–µ', icon:'list-ordered'}, {label:'–°–∞–º–æ–≤—ã–≤–æ–∑',icon:'briefcase'}, {label:'–ë—É—Ä–≥–µ—Ä—ã',icon:'sandwich'}, {label:'–ö–æ–º–±–æ',icon:'box'}, {label:'–ü–∏—Ü—Ü–∞',icon:'slice'}, {label:'–°—É—à–∏',icon:'fish'}, {label:'–ó–¥–æ—Ä–æ–≤—å–µ',icon:'salad'}, {label:'–ê–∑–∏—è',icon:'ramen'}, {label:'–ì—Ä—É–∑–∏—è',icon:'utensils-crossed'}, {label:'–î–µ—Å–µ—Ä—Ç—ã',icon:'cake'}, {label:'–ö–æ—Ñ–µ',icon:'coffee'}, {label:'–í–µ–≥–∞–Ω',icon:'leaf'}
      ];

      // --- UI refs ---
      const authModal = document.getElementById('auth-modal'); const loginButton = document.getElementById('login-button'); const authCloseButton = document.getElementById('auth-close-button'); const authBackButton = document.getElementById('auth-back-button'); const authTitle = document.getElementById('auth-title');
      const screenMain = document.getElementById('screen-main'), screenCode = document.getElementById('screen-code'), screenRegister = document.getElementById('screen-register');
      const tabEmail=document.getElementById('tab-email'), tabPhone=document.getElementById('tab-phone');
      const loginEmailInput=document.getElementById('login-email-input'), loginPasswordInput=document.getElementById('login-password-input'), loginSubmitButton=document.getElementById('login-submit-button');
      const phoneSubmitButton=document.getElementById('phone-submit-button'), loginPhoneInput=document.getElementById('login-phone-input');
      const goToRegisterButton=document.getElementById('go-to-register-button');
      const codePhoneDisplay=document.getElementById('code-phone-display'), smsCodeInput=document.getElementById('sms-code-input'), codeSubmitButton=document.getElementById('code-submit-button'), codeErrorMessage=document.getElementById('code-error-message'), resendCodeButton=document.getElementById('resend-code-button');
      const regTabPhone=document.getElementById('reg-tab-phone'), regTabEmail=document.getElementById('reg-tab-email'), registerPhoneInput=document.getElementById('register-phone-input'), registerPhoneSubmitButton=document.getElementById('register-phone-submit-button');
      const registerEmailScreen=document.getElementById('register-email-screen'), registerPhoneScreen=document.getElementById('register-phone-screen');
      const registerEmailInput=document.getElementById('register-email-input'), registerPasswordInput=document.getElementById('register-password-input'), registerConfirmPasswordInput=document.getElementById('register-confirm-password-input'), registerEmailSubmitButton=document.getElementById('register-email-submit-button');
      const pwStrengthBar=document.getElementById('pw-strength-bar');

      // state
      let currentFilter='–í—Å–µ'; let currentSearchQuery=''; let smsCode=null; let smsTargetPhone='';

      // session
      function setLoggedIn(user){ saveSession({user}); renderUserArea(); hideModal(); }
      function logout(){ clearSession(); renderUserArea(); }

      // --- Modal helpers ---
      function showModal(){ authModal.classList.remove('opacity-0','pointer-events-none'); resetModal(); }
      function hideModal(){ authModal.classList.add('opacity-0','pointer-events-none'); }
      function resetModal(){ screenMain.classList.remove('hidden'); screenCode.classList.add('hidden'); screenRegister.classList.add('hidden'); authBackButton.classList.add('hidden'); authTitle.textContent='–í–æ–π–¥–∏—Ç–µ'; codeErrorMessage.classList.add('hidden'); smsCodeInput.value=''; }

      function navigateTo(screen){ screenMain.classList.add('hidden'); screenCode.classList.add('hidden'); screenRegister.classList.add('hidden'); authBackButton.classList.toggle('hidden', screen==='main'); if(screen==='main'){ screenMain.classList.remove('hidden'); authTitle.textContent='–í–æ–π–¥–∏—Ç–µ' } if(screen==='code'){ screenCode.classList.remove('hidden'); authTitle.textContent='–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ' } if(screen==='register'){ screenRegister.classList.remove('hidden'); authTitle.textContent='–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' } }

      // --- Login/Register logic using localStorage ---
      tabEmail.addEventListener('click', ()=>{ tabEmail.classList.add('bg-white','shadow-sm'); tabPhone.classList.remove('bg-white','shadow-sm'); document.getElementById('login-email-screen').classList.remove('hidden'); document.getElementById('login-phone-screen').classList.add('hidden'); });
      tabPhone.addEventListener('click', ()=>{ tabPhone.classList.add('bg-white','shadow-sm'); tabEmail.classList.remove('bg-white','shadow-sm'); document.getElementById('login-email-screen').classList.add('hidden'); document.getElementById('login-phone-screen').classList.remove('hidden'); });

      regTabPhone.addEventListener('click', ()=>{ regTabPhone.classList.add('bg-white','shadow-sm'); regTabEmail.classList.remove('bg-white','shadow-sm'); registerPhoneScreen.classList.remove('hidden'); registerEmailScreen.classList.add('hidden'); });
      regTabEmail.addEventListener('click', ()=>{ regTabEmail.classList.add('bg-white','shadow-sm'); regTabPhone.classList.remove('bg-white','shadow-sm'); registerEmailScreen.classList.remove('hidden'); registerPhoneScreen.classList.add('hidden'); });

      // email login
      loginSubmitButton.addEventListener('click', ()=>{
        const email=loginEmailInput.value.trim(), pw=loginPasswordInput.value;
        if(!email||!pw){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'); return }
        const users=loadUsers(); const user=users[email.toLowerCase()];
        if(!user || user.password!==pw){ alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å'); return }
        setLoggedIn({email:email, name:user.name||email.split('@')[0]});
      });

      // phone -> code
      phoneSubmitButton.addEventListener('click', ()=>{
        const phone=loginPhoneInput.value.replace(/[^0-9]/g,'').slice(-10);
        if(phone.length<7){ alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä'); return }
        smsTargetPhone=phone; smsCode=String(Math.floor(1000+Math.random()*9000)); codePhoneDisplay.textContent=`+7 ${phone}`; navigateTo('code'); startResendCooldown(); console.log('SMS CODE',smsCode);
      });

      // code confirm
      codeSubmitButton.addEventListener('click', ()=>{
        const code=smsCodeInput.value.trim(); if(!code){ alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥'); return }
        if(code===smsCode){ // successful
          // create or find user by phone
          const users=loadUsers(); const emailKey='phone_'+smsTargetPhone; if(!users[emailKey]){ users[emailKey]={name:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', password:'', phone:smsTargetPhone}; saveUsers(users) }
          setLoggedIn({email:emailKey, name:users[emailKey].name||('+'+smsTargetPhone)});
        } else { codeErrorMessage.classList.remove('hidden'); codeErrorMessage.textContent='–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥'; }
      });

      // resend with cooldown
      let resendTimer=null; function startResendCooldown(){ let t=30; resendCodeButton.disabled=true; resendCodeButton.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ (30s)'; resendTimer=setInterval(()=>{ t--; resendCodeButton.textContent=`–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ (${t}s)`; if(t<=0){ clearInterval(resendTimer); resendCodeButton.disabled=false; resendCodeButton.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ' } },1000) }
      resendCodeButton.addEventListener('click', ()=>{ if(resendCodeButton.disabled) return; smsCode=String(Math.floor(1000+Math.random()*9000)); console.log('Resent code',smsCode); startResendCooldown(); alert('–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ') });

      // register phone
      registerPhoneSubmitButton.addEventListener('click', ()=>{ const phone=registerPhoneInput.value.replace(/[^0-9]/g,'').slice(-10); if(phone.length<7){ alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä'); return } smsTargetPhone=phone; smsCode=String(Math.floor(1000+Math.random()*9000)); codePhoneDisplay.textContent=`+7 ${phone}`; navigateTo('code'); startResendCooldown(); console.log('REG SMS',smsCode); });

      // register by email
      registerEmailSubmitButton.addEventListener('click', ()=>{
        const email=registerEmailInput.value.trim().toLowerCase(); const pw=registerPasswordInput.value; const cpw=registerConfirmPasswordInput.value;
        if(!email||!pw||!cpw){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return }
        if(pw!==cpw){ alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'); return }
        const users=loadUsers(); if(users[email]){ alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return }
        users[email]={name:email.split('@')[0], password:pw}; saveUsers(users); setLoggedIn({email, name:users[email].name}); alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞');
      });

      // password strength
      registerPasswordInput.addEventListener('input', ()=>{ const v=registerPasswordInput.value; let score=0; if(v.length>=8) score+=30; if(/[A-Z]/.test(v)) score+=20; if(/[0-9]/.test(v)) score+=20; if(/[^A-Za-z0-9]/.test(v)) score+=30; const w=Math.min(100,score); pwStrengthBar.style.width=w+'%'; });

      // toggle pw
      document.getElementById('toggle-login-pw').addEventListener('click', ()=>{ const el=loginPasswordInput; el.type=el.type==='password'?'text':'password'; });
      document.getElementById('toggle-reg-pw').addEventListener('click', ()=>{ const el=registerPasswordInput; el.type=el.type==='password'?'text':'password'; });

      goToRegisterButton.addEventListener('click', ()=>{ navigateTo('register'); authBackButton.classList.remove('hidden'); });
      authCloseButton.addEventListener('click', hideModal);
      authBackButton.addEventListener('click', ()=>{ navigateTo('main'); });
      loginButton.addEventListener('click', showModal);

      // render user area
      function renderUserArea(){ const sess=loadSession(); const area=document.getElementById('user-area'); area.innerHTML=''; if(sess && sess.user){ const name=sess.user.name||sess.user.email; const avatarText=(name[0]||'U').toUpperCase(); const html=`<div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-200 text-gray-900 font-semibold flex items-center justify-center">${avatarText}</div><div class="hidden sm:block"><div class="text-sm font-medium">${name}</div><button id="logout-btn" class="text-xs text-gray-500">–í—ã–π—Ç–∏</button></div></div>`; area.insertAdjacentHTML('beforeend',html); document.getElementById('logout-btn').addEventListener('click', ()=>{ logout(); alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞'); }); } else { area.innerHTML=`<button id="login-button" class="text-sm font-medium py-1.5 px-4 rounded-full bg-gray-100 hover:bg-gray-200 transition">–í–æ–π—Ç–∏</button>`; document.getElementById('login-button').addEventListener('click', showModal); } }

      // --- Filtering / Rendering restaurants & categories ---
      const restaurantGrid=document.getElementById('restaurant-grid'), categoriesContainer=document.getElementById('categories-container'), manualSearchInput=document.getElementById('manual-search');
      function renderCategories(){ categoriesContainer.innerHTML=''; categories.forEach(cat=>{ const isActive=cat.label===currentFilter; const activeClass=isActive?'accent-bg text-black font-bold':'bg-gray-100 text-gray-700 hover:bg-gray-200'; const btn=document.createElement('button'); btn.className=`category-btn flex items-center flex-shrink-0 text-sm py-2 px-4 rounded-full transition ${activeClass}`; btn.dataset.category=cat.label; btn.innerHTML=`<i data-lucide="${cat.icon}" class="w-4 h-4 mr-1"></i><span>${cat.label}</span>`; categoriesContainer.appendChild(btn); btn.addEventListener('click', ()=>{ currentFilter=cat.label; currentSearchQuery=''; manualSearchInput.value=''; renderCategories(); applyFilters(); }); }); lucide.createIcons(); }

      function applyFilters(){ let out=mockRestaurants.slice(); if(currentFilter!=='–í—Å–µ' && currentFilter!=='–°–∞–º–æ–≤—ã–≤–æ–∑'){ out=out.filter(r=>r.category===currentFilter); } if(currentSearchQuery){ const q=currentSearchQuery.toLowerCase(); out=out.filter(r=>r.name.toLowerCase().includes(q) || r.cuisine.toLowerCase().includes(q) || r.category.toLowerCase().includes(q)); } renderRestaurants(out); }

      function renderRestaurants(restaurants){ restaurantGrid.innerHTML=''; if(restaurants.length===0){ restaurantGrid.innerHTML=`<div class="col-span-full text-center py-10 bg-secondary rounded-xl"><i data-lucide="info" class="w-12 h-12 text-yellow-500 mx-auto mb-4"></i><p class="text-xl font-semibold text-primary">–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p></div>`; lucide.createIcons(); return } restaurants.forEach(resto=>{ const freeTag=resto.freeDelivery?'<div class="absolute bottom-3 left-3 bg-green-500 text-white text-xs font-semibold px-2 py-0.5 rounded-full shadow-md z-10">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</div>':''; const card=document.createElement('div'); card.className='bg-white rounded-xl overflow-hidden shadow-lg border border-gray-100 hover:shadow-xl transition-all'; card.innerHTML=`<a href="#" class="block"><div class="relative"><img src="${resto.image}" alt="${resto.name}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/333333?text=–ù–µ—Ç+–§–æ—Ç–æ';">${freeTag}</div><div class="p-4"><h3 class="text-lg font-bold text-primary mb-1">${resto.name}</h3><p class="text-sm text-secondary mb-3">${resto.cuisine}</p><div class="flex items-center justify-between text-sm"><div class="flex items-center space-x-3 font-medium text-primary"><span class="flex items-center space-x-1"><i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current"></i><span>${resto.rating}</span></span><span class="text-gray-500 font-bold">${resto.priceRange}</span></div><span class="flex items-center space-x-1 text-gray-600"><i data-lucide="clock" class="w-4 h-4 text-gray-400"></i><span>${resto.deliveryTime}</span></span></div></div></a>`; restaurantGrid.appendChild(card); }); lucide.createIcons(); }

      // search debounce
      let searchTimer=null; manualSearchInput.addEventListener('input', (e)=>{ currentSearchQuery=e.target.value.trim(); currentFilter='–í—Å–µ'; renderCategories(); clearTimeout(searchTimer); searchTimer=setTimeout(()=>{ applyFilters(); },350); });

      // AI helper (uses Gemini only if API key set; otherwise local fallback)
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`;
      const API_KEY = '';
      const aiButton=document.getElementById('ai-button'), aiLoader=document.getElementById('ai-loader'), aiButtonText=document.getElementById('ai-button-text'), aiResult=document.getElementById('ai-result'), aiPlaceholder=document.getElementById('ai-placeholder'), aiOutput=document.getElementById('ai-output'), aiPrompt=document.getElementById('ai-prompt');

      async function getAiSuggestion(){ const prompt=aiPrompt.value.trim(); if(!prompt){ aiOutput.textContent='–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å.'; aiResult.classList.remove('hidden'); aiPlaceholder.classList.add('hidden'); return }
        aiLoader.classList.remove('hidden'); aiButtonText.classList.add('hidden'); aiButton.disabled=true;
        try{
          if(API_KEY){ // real call
            const systemPrompt = `–¢—ã - AI-–ø–æ–º–æ—â–Ω–∏–∫... (—Å–æ–∫—Ä–∞—â–µ–Ω–æ)`;
            const payload={contents:[{parts:[{text:prompt}]}], systemInstruction:{parts:[{text:systemPrompt}]}};
            const resp=await fetch(API_URL+API_KEY,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
            if(resp.ok){ const res=await resp.json(); const text=res.candidates?.[0]?.content?.parts?.[0]?.text || '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'; aiOutput.innerHTML=text.replace(/\n/g,'<br>'); }
            else{ throw new Error('AI error'); }
          } else { // fallback: simple local suggestions
            const suggestions = [];
            const q = prompt.toLowerCase();
            if(/—Å–∞–ª–∞—Ç|–ª–µ–≥–∫|–ø–æ–ª–µ–∑–Ω/.test(q)) suggestions.push('* –õ–µ–≥–∫–∏–π —Å–∞–ª–∞—Ç —Å –∫–∏–Ω–æ–∞\n* –ì—Ä–µ—á–µ—Å–∫–∏–π —Å–∞–ª–∞—Ç\n* –°–º—É–∑–∏ –±–æ—É–ª —Å —è–≥–æ–¥–∞–º–∏');
            else if(/–ø–∏—Ü—Ü|–ø–µ–ø–ø–µ—Ä|—Ç–æ–Ω–∫/.test(q)) suggestions.push('* –ü–∏—Ü—Ü–∞ "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏" –Ω–∞ —Ç–æ–Ω–∫–æ–º —Ç–µ—Å—Ç–µ\n* –°–∞–ª–∞—Ç —Ü–µ–∑–∞—Ä—å\n* –¢–∏—Ä–∞–º–∏—Å—É (–Ω–∞ –¥–µ—Å–µ—Ä—Ç)');
            else suggestions.push('* –†–∞–º–µ–Ω —Å –∫—É—Ä–∏—Ü–µ–π\n* –ë—É—Ä–≥–µ—Ä—ã —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª–µ–º\n* –°–∞–ª–∞—Ç —Å –∫–∏–Ω–æ–∞');
            aiOutput.innerHTML = suggestions[0].replace(/\n/g,'<br>');
          }
        }catch(e){ console.error(e); aiOutput.textContent='–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' }
        finally{ aiLoader.classList.add('hidden'); aiButtonText.classList.remove('hidden'); aiButton.disabled=false; aiResult.classList.remove('hidden'); aiPlaceholder.classList.add('hidden'); }
      }
      aiButton.addEventListener('click', getAiSuggestion); document.getElementById('ai-clear').addEventListener('click', ()=>{ aiPrompt.value=''; aiOutput.innerHTML=''; aiResult.classList.add('hidden'); aiPlaceholder.classList.remove('hidden'); }); aiPrompt.addEventListener('keydown',(e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); getAiSuggestion(); } });

      // cart persistence
      function loadCart(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEYS.CART))||{count:0}}catch(e){return{count:0}} }
      function saveCart(c){ localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(c)); }
      function setCartCount(n){ document.getElementById('cart-count').textContent=n; }
      // init sample cart
      const cart = loadCart(); setCartCount(cart.count||0);

      // init
      function init(){ lucide.createIcons(); renderCategories(); applyFilters(); renderUserArea(); }
      document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
